<?xml version="1.0" encoding="UTF-8"?>
<project name="sdk-dist" default="dist" basedir=".">
  <description>builds the release distribution for this project.</description>
  
  <target name="init">
    <property file="build.properties"/>
    <property file="sdk.properties"/>
    <property name="build.dir" value="build"/>
    <property name="build.web.dir" value="${build.dir}/web"/>
    <property name="build.classes.dir" 
              value="${build.web.dir}/WEB-INF/classes"/>
    <property name="javadoc.dir" value="docs/javadoc"/>
    <property name="dist.dir" value="dist"/>    
    <property name="build.classpath" value="${servlet-api-jar.path}"/>
  </target>

  <target name="compile" depends="init">
    <mkdir dir="${build.classes.dir}"/>
    <javac srcdir="src" destdir="${build.classes.dir}" debug="true" debuglevel="source,lines,vars"
           classpath="${build.classpath}" source="1.5" target="1.5"/>
    <copy todir="${build.classes.dir}">
      <fileset dir="src/java">
        <include name="**/*.xsl" />
      </fileset>
    </copy>
  </target>
  
  <target name="war" depends="init,compile">
    <copy todir="${build.web.dir}">
      <fileset dir="web">
        <exclude name="**/sun-web.xml" />
      </fileset>
    </copy>
    <mkdir dir="${dist.dir}"/>
    <jar jarfile="${dist.dir}/checkout-sdk.war" basedir="${build.web.dir}"/>
  </target>
  
  <target name="dist" depends="war">
    <mkdir dir="${dist.dir}"/>
    <jar basedir="${build.classes.dir}" 
         jarfile="${dist.dir}/checkout-sdk.jar"/>
  </target>

  <target name="javadoc" depends="init,compile">
  	<mkdir dir="${javadoc.dir}"/>
    <javadoc sourcepath="src/java" destdir="${javadoc.dir}" 
             classpath="${build.classpath}"
             packagenames="com.google.*" 
             Windowtitle="Google Java Checkout SDK API"
  	     Doctitle="Google Java Checkout API"/>
  </target>
  
  <target name="clean" depends="init">
    <delete dir="${build.dir}"/>
    <delete dir="${javadoc.dir}"/>
    <delete dir="${dist.dir}"/>
  </target>
  
  <target name="all" depends="dist,javadoc"/>
</project>
